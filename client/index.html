<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My document</title>
</head>

<body>

    <button id="createList">New List</button>
    <button id="showUser">My Profile</button>
    <button id="logout">Log Out</button>
    <div id="container"></div>

</body>

<script>

    let createList = document.getElementById('createList');
    let showUser = document.getElementById('showUser');
    let logout = document.getElementById('logout');
    let container = document.getElementById('container');

    let url = "http://localhost:3000/lists";

    createList.addEventListener('click', function () {
        // create list
    });

    showUser.addEventListener('click', function () {
        window.location.href = "./user.html";
    });

    logout.addEventListener('click', function () {
        sessionStorage.removeItem('logindata');
        window.location.href = "./userlogin.html";
    });

    async function showLists() {
        try {
            let logindata = JSON.parse(sessionStorage.getItem("logindata"));
            let token = logindata.token;

            let cfg = {
                method: "GET",
                headers: { "authorisation": token }
            };

            var resp = await fetch(url, cfg);
            var data = await resp.json();

            if (resp.status == 403) {
                // If user hasn't logged in, go to the login page
                window.location.href = "./userlogin.html";
                return;
            } else if (resp.status > 202) {
                throw (data);
            }

            container.innerHTML = ""; // delete previous content

            for (let value of data) {

                let div = document.createElement('div');
                let html = `<h3>${value.name}</h3>
                            <hr>`;
                div.innerHTML = html;

                div.addEventListener('click', function (evt) {
                    console.log(`open list ${value.name}`);
                });

                container.appendChild(div);
            }
        }
        catch (err) {
            console.log(err);
        }
    }

    showLists();

</script>

</html>